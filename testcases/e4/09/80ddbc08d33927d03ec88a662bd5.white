GET /spc.php?zones=1%7C2%7C3%7C5%7C6%7C7%7C9%7C10%7C11%7C12%7C13%7C14%7C15%7C16%7C17%7C24%7C25%7C26%7C27%7C28%7C29%7C31%7C32&source=&r=70845212&block=1&repu=0&v=5f0a9217&charset=UTF-8&loc=https%3A//segmentfault.com/search%3Fq%3DBest+practices+for+exporting+and+importing+data+from+Amazon+Aurora+MySQL+to+Amazon+S3+by+Suresh+Patnam+and+Mahesh+Goyal+%257C+on+15+JUN+2020+%257C+in+Amazon+Aurora%252C+MySQL+Compatible+%257C+Permalink+%257C++Comments+%257C++Share+You+can+build+highly+distributed+applications+using+a+multitude+of+purpose-built+databases+by+decoupling+complex+applications+into+smaller+pieces%252C+which+allows+you+to+choose+the+right+database+for+the+right+job.+Amazon+Aurora+is+the+preferred+choice+for+OLTP+workloads.+Aurora+makes+it+easy+to+set+up%252C+operate%252C+and+scale+a+relational+database+in+the+cloud.++This+post+demonstrates+how+you+can+export+and+import+the+data+from+Aurora+MySQL+to+Amazon+Simple+Storage+Service+%2528Amazon+S3%2529+and+shares+associated+best+practices.+Export+import+data+to+Amazon+S3+feature+is+also+available+for+Amazon+Aurora+PostgreSQL.+This+blog+post+focuses+on+Amazon+Aurora+MySQL.++Overview+of+Aurora+and+Amazon+S3+Aurora+is+a+MySQL+and+PostgreSQL-compatible+relational+database+built+for+the+cloud%252C+which+combines+the+performance+and+availability+of+traditional+enterprise+databases+with+the+simplicity+and+cost-effectiveness+of+open-source+databases.++Amazon+S3+is+an+object+storage+service+that+offers+industry-leading+scalability%252C+data+availability%252C+security%252C+and+performance.+This+means+customers+of+all+sizes+and+industries+can+use+it+to+store+and+protect+any+amount+of+data.++Prerequisites+Before+you+get+started%252C+complete+the+following%253A++Launch+an+Aurora+MySQL+DB+cluster.+You+can+also+use+an+existing+cluster.+Launch+an+Amazon+EC2+instance+that+you+installed+the+MySQL+client+on.+You+can+also+use+MySQL+Workbench+for+this+purpose.+Create+the+following+required+Identity+and+Access+Management+%2528IAM%2529+policies+and+roles%253A+Create+an+IAM+policy+with+the+least-restricted+privilege+to+the+resources+in+the+following+code+and+name+it+aurora-s3-access-pol.+The+policy+must+have+access+to+the+S3+bucket+where+the+files+are+stored+%2528for+this+post%252C+sample-loaddata01%2529.+%257B+++++%2522Version%2522%253A+%25222012-10-17%2522%252C+++++%2522Statement%2522%253A+%255B+++++++++%257B+++++++++++++%2522Effect%2522%253A+%2522Allow%2522%252C+++++++++++++%2522Action%2522%253A+%255B+++++++++++++++++%2522s3%253AGetObject%2522%252C++++++++++++++++++++%2522s3%253AAbortMultipartUpload%2522%252C++++++++++++++++++++%2522s3%253ADeleteObject%2522%252C++++++++++++++++++++%2522s3%253AListMultipartUploadParts%2522%252C++++++++++++++++++++%2522s3%253APutObject%2522%252C++++++++++++++++++++%2522s3%253AListBucket%2522+++++++++++++%255D%252C+++++++++++++%2522Resource%2522%253A+%255B+++++++++++++++++%2522arn%253Aaws%253As3%253A%253A%253Asample-loaddata01%252F*%2522%252C+++++++++++++++++%2522arn%253Aaws%253As3%253A%253A%253Asample-loaddata01%2522+++++++++++++%255D+++++++++%257D+++++%255D+%257D+Create+an+IAM+role+and+modify+the+trust+relationship+according+to+the+following+code.+AssumeRole+allows+Aurora+to+access+other+AWS+services+on+your+behalf.+%257B+%2522Version%2522%253A+%25222012-10-17%2522%252C+++%2522Statement%2522%253A+%255B+++++%257B+++++++%2522Effect%2522%253A+%2522Allow%2522%252C+++++++%2522Principal%2522%253A+%257B+++++++++%2522Service%2522%253A+%2522rds.amazonaws.com%2522+++++++%257D%252C+++++++%2522Action%2522%253A+%2522sts%253AAssumeRole%2522+++++%257D+++%255D+%257D+Attach+the+policy+aurora-s3-access-pol+from+the+previous+step.+For+this+post%252C+the+role+is+named+s3-demo-access-role+and+the+role+ARN+is+arn%253Aaws%253Aiam%253A%253A123456789012%253Arole%252Faurora-s3-access-role.+Create+and+assign+parameter+groups+for+the+cluster%253A+Create+a+custom+parameter+group+using+the+AWS+Command+Line+Interface+%2528AWS+CLI%2529.+See+the+following+code%253A+aws+rds+create-db-cluster-parameter-group+%255C+--db-cluster-parameter-group-name+aurora-cluster-para-grp+%255C+--db-parameter-group-family+aurora5.6+%255C+--description+%2522cluster+parameter+group+for+s3+copy%2522++Modify+the+parameter+group+to+edit+the+value+of+the+aurora_default_s3_role+parameter+to+the+IAM+role+s3-demo-access-role.+See+the+following+code%253A+aws+rds+modify-db-cluster-parameter-group+%255C+++--db-cluster-parameter-group-name+aurora-cluster-para-grp+%255C+++--parameters+%2522ParameterName%253Daurora_default_s3_role%252CParameterValue%253Darn%253Aaws%253Aiam%253A%253A123456789012%253Arole%252Faurora-s3-access-role%252CApplyMethod%253Dimmediate%2522+You+can+map+the+IAM+role+to+the+aurora_select_into_s3_role+parameter+to+allow+only+data+export+or+map+the+aurora_load_from_s3_role+parameter+to+allow+only+data+import+from+the+S3+bucket.+If+the+IAM+role+isn%25E2%2580%2599t+specified+for+these+two+parameters%252C+Aurora+uses+the+IAM+role+specified+in+aws_default_s3_role+for+both+export+and+import.++Modify+the+Aurora+cluster+and+associate+the+newly+created+parameter+group.+See+the+following+code%253A+aws+rds+modify-db-cluster+%255C+++--db-cluster-identifier+database-1+%255C+++--db-cluster-parameter-group-name+aurora-cluster-para-grp+%255C+++--apply-immediately+The+apply-immediately+code+triggers+modification+and+asynchronously+applies+changes+as+soon+as+possible+regardless+of+the+PreferredMaintenanceWindow+on+the+DB+cluster.++Associate+the+IAM+role+to+the+cluster.+This+allows+database+users+in+an+Aurora+DB+cluster+to+access+the+S3+bucket.+See+the+following+code%253A+aws+rds+add-role-to-db-cluster+%255C+++++--db-cluster-identifier+database-1+%255C+++++--role-arn+arn%253Aaws%253Aiam%253A%253A123456789012%253Arole%252Faurora-s3-access-role+Reboot+the+primary+instance+in+the+cluster+to+apply+the+changes.+See+the+following+code%253A+aws+rds+reboot-db-instance+%255C+++++++--db-instance-identifier+database-1-instance-1+You%25E2%2580%2599re+now+ready+to+explore+the+following+use+cases+of+exporting+and+importing+data.++Exporting+data+from+Aurora+MySQL+to+Amazon+S3+To+export+your+data%252C+complete+the+following+steps%253A++Connect+to+the+cluster+as+the+master+user.+By+default%252C+the+master+user+has+permission+to+export+and+import+data+from+Amazon+S3.+For+this+post%252C+you+create+a+test+user+with+the+least-required+permission+to+export+data+to+the+S3+bucket.+See+the+following+code%253A+%2524+mysql+-h+database-1.cluster-xxxxxxxxxxxx.us-west-2.rds.amazonaws.com+-D+sampledb01+-P+3306+-u+admin01+-p+Create+the+user+testuser+and+grant+the+required+privileges+to+the+user+on+the+database.+This+post+uses+sampledb01.+See+the+following+code%253A+MySQL%253E+create+user+%2527testuser%2527%2540%2527%2525%2527+identified+by+%2527Password%2527%253B+MySQL%253E+grant+select+on+sampledb01.*+to+%2527testuser%2527%2540%2527%2525%2527%253B+Grant+the+SELECT+INTO+S3+privilege+to+testuser+with+the+following+code%253A+MySQL%253E+grant+SELECT+INTO+S3+on+*.*+to+%2527testuser%2527%2540%2527%2525%2527%253B+Log+in+to+the+cluster+as+testuser%253A+%2524+mysql+-h+database-1.cluster-xxxxxxxxxxxx.us-west-2.rds.amazonaws.com+-D+sampledb01+-P+3306+-u+testuser+-p+For+this+post%252C+you+export+the+lineitem+table+to+the+S3+bucket.+You+can+use+any+existing+table+in+your+database+%2528preferably+small+size%2529+to+test+this+feature.+See+the+following+code%253A+MySQL%253E+describe+lineitem%253B+%252B-----------------%252B-------------%252B------%252B-----%252B---------%252B-------%252B+%257C+Field+++++++++++%257C+Type++++++++%257C+Null+%257C+Key+%257C+Default+%257C+Extra+%257C+%252B-----------------%252B-------------%252B------%252B-----%252B---------%252B-------%252B+%257C+orderkey++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+linenumber++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+custkey+++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+partkey+++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+suppkey+++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+orderdate+++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+orderpriority+++%257C+varchar%252815%2529+%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+shippriority++++%257C+varchar%25281%2529++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+quantity++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+extendedprice+++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+ordertotalprice+%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+discount++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+revenue+++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+supplycost++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+tax+++++++++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+commitdate++++++%257C+int%252811%2529+++++%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%257C+lshipmode+++++++%257C+varchar%252810%2529+%257C+NO+++%257C+++++%257C+NULL++++%257C+++++++%257C+%252B-----------------%252B-------------%252B------%252B-----%252B---------%252B-------%252B++The+following+screenshot+displays+a+few+records+from+the+lineitem+table.+++To+export+data+from+the+Aurora+table+to+the+S3+bucket%252C+use+the+SELECT+INTO+OUTFILE+S3+The+following+statement+exports+the+entire+table+to+the+S3+bucket.+If+you%25E2%2580%2599re+trying+this+feature+out+for+the+first+time%252C+consider+using+the+LIMIT+clause+for+a+larger+table.+See+the+following+code%253A+MySQL%253E+SELECT+*+FROM+lineitem+INTO+OUTFILE+S3++%2527s3%253A%252F%252Fsample-loaddata01%252Funload-data%252Ffile%2527+FIELDS+TERMINATED+BY+%2527%252C%2527+LINES+TERMINATED+BY+%2527%255Cn%2527%253B+Query+OK%252C+50000000+rows+affected+%25283+min+37.05+sec%2529+The+following+code+shows+the+exported+file+in+the+S3+bucket.+The+default+file+size+threshold+is+6+GB.+Because+the+data+selected+by+the+statement+is+less+than+the+file+size+threshold%252C+a+single+file+is+created.++%2524aws+s3+ls+s3%253A%252F%252Fsample-loaddata01%252Funload-data+--recursive+--human-readable+--summarize+2020-04-29+00%253A10%253A17++++4.7+GiB+unload-data%252Ffile.part_00000+If+you+need+the+file+size+to+be+smaller+than+6+GB%252C+you+can+identify+a+column+to+split+the+table+data+into+small+portions+and+run+multiple+SELECT+INTO+OUTFILE+statements+%2528using+the+WHERE+condition%2529.+It%25E2%2580%2599s+best+to+do+this+when+the+amount+of+data+selected+is+more+than+25+GB.++Importing+data+from+Amazon+S3+to+Aurora+MySQL+In+this+section%252C+you+load+the+data+back+to+the+Aurora+table+from+the+Amazon+S3+file.+Complete+the+following+steps%253A++Grant+the+LOAD+FROM+S3+privilege+to+testuser.+See+the+following+code%253A+MySQL%253E+grant+LOAD+FROM+S3+on+*.*+to+%2527testuser%2527%2540%2527%2525%2527%253B+Use+LOAD+DATA+FROM+S3+to+import+the+data+file+from+an+Amazon+S3+prefix.+See+the+following+code%253A+MySQL+%253E+LOAD+DATA+FROM+S3+PREFIX+%2527s3%253A%252F%252Fsample-loaddata01%252Funload-data%252Ffile%2527+INTO+TABLE+lineitem++FIELDS+TERMINATED+BY+%2527%252C%2527++++LINES+TERMINATED+BY+%2527%255Cn%2527+%2528orderkey%252Clinenumber%252Ccustkey%252Cpartkey%252Csuppkey%252Corderdate%252Corderpriority%252Cshippriority%252Cquantity%252Cextendedprice%252Cordertotalprice%252Cdiscount%252Crevenue%252Csupplycost%252Ctax%252Ccommitdate%252Cshipmode%2529%253B+Query+OK%252C+50000000+rows+affected+%2528+8+min+16+sec%2529+Verify+the+loaded+files+using+the+aurora_s3_load_history+system+table.+See+the+following+code%253A+MySQL%253E+select+*+from+mysql.aurora_s3_load_history+order+by+load_timestamp+desc+limit+1%255CG%253B++***************************+1.+row+***********************+++load_prefix%253A+s3%253A%252F%252Fsample-loaddata01%252Funload-data%252Ffile++++++file_name%253A+unload-data%252Ffile.part_00000+version_number%253A++++bytes_loaded%253A+5052058881+load_timestamp%253A+2020-05-05+18%253A09%253A53+Best+practices&referer=https%3A//segmentfault.com/ HTTP/1.1
Host: sponsor.segmentfault.com
Sec-Ch-Ua: "Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"
Sec-Ch-Ua-Mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36
Sec-Ch-Ua-Platform: "Windows"
Accept: */*
Sec-Fetch-Site: same-site
Sec-Fetch-Mode: no-cors
Sec-Fetch-Dest: script
Referer: https://segmentfault.com/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7

