POST /api/event HTTP/1.1
Host: stats.segmentfault.net
Content-Length: 11128
Sec-Ch-Ua: "Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"
Sec-Ch-Ua-Platform: "Windows"
Sec-Ch-Ua-Mobile: ?0
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36
Content-Type: text/plain
Accept: */*
Origin: https://segmentfault.com
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: cors
Sec-Fetch-Dest: empty
Referer: https://segmentfault.com/
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7

{"n":"pageview","u":"https://segmentfault.com/search?q=Best+practices+for+exporting+and+importing+data+from+Amazon+Aurora+MySQL+to+Amazon+S3+by+Suresh+Patnam+and+Mahesh+Goyal+%7C+on+15+JUN+2020+%7C+in+Amazon+Aurora%2C+MySQL+Compatible+%7C+Permalink+%7C++Comments+%7C++Share+You+can+build+highly+distributed+applications+using+a+multitude+of+purpose-built+databases+by+decoupling+complex+applications+into+smaller+pieces%2C+which+allows+you+to+choose+the+right+database+for+the+right+job.+Amazon+Aurora+is+the+preferred+choice+for+OLTP+workloads.+Aurora+makes+it+easy+to+set+up%2C+operate%2C+and+scale+a+relational+database+in+the+cloud.++This+post+demonstrates+how+you+can+export+and+import+the+data+from+Aurora+MySQL+to+Amazon+Simple+Storage+Service+%28Amazon+S3%29+and+shares+associated+best+practices.+Export+import+data+to+Amazon+S3+feature+is+also+available+for+Amazon+Aurora+PostgreSQL.+This+blog+post+focuses+on+Amazon+Aurora+MySQL.++Overview+of+Aurora+and+Amazon+S3+Aurora+is+a+MySQL+and+PostgreSQL-compatible+relational+database+built+for+the+cloud%2C+which+combines+the+performance+and+availability+of+traditional+enterprise+databases+with+the+simplicity+and+cost-effectiveness+of+open-source+databases.++Amazon+S3+is+an+object+storage+service+that+offers+industry-leading+scalability%2C+data+availability%2C+security%2C+and+performance.+This+means+customers+of+all+sizes+and+industries+can+use+it+to+store+and+protect+any+amount+of+data.++Prerequisites+Before+you+get+started%2C+complete+the+following%3A++Launch+an+Aurora+MySQL+DB+cluster.+You+can+also+use+an+existing+cluster.+Launch+an+Amazon+EC2+instance+that+you+installed+the+MySQL+client+on.+You+can+also+use+MySQL+Workbench+for+this+purpose.+Create+the+following+required+Identity+and+Access+Management+%28IAM%29+policies+and+roles%3A+Create+an+IAM+policy+with+the+least-restricted+privilege+to+the+resources+in+the+following+code+and+name+it+aurora-s3-access-pol.+The+policy+must+have+access+to+the+S3+bucket+where+the+files+are+stored+%28for+this+post%2C+sample-loaddata01%29.+%7B+++++%22Version%22%3A+%222012-10-17%22%2C+++++%22Statement%22%3A+%5B+++++++++%7B+++++++++++++%22Effect%22%3A+%22Allow%22%2C+++++++++++++%22Action%22%3A+%5B+++++++++++++++++%22s3%3AGetObject%22%2C++++++++++++++++++++%22s3%3AAbortMultipartUpload%22%2C++++++++++++++++++++%22s3%3ADeleteObject%22%2C++++++++++++++++++++%22s3%3AListMultipartUploadParts%22%2C++++++++++++++++++++%22s3%3APutObject%22%2C++++++++++++++++++++%22s3%3AListBucket%22+++++++++++++%5D%2C+++++++++++++%22Resource%22%3A+%5B+++++++++++++++++%22arn%3Aaws%3As3%3A%3A%3Asample-loaddata01%2F*%22%2C+++++++++++++++++%22arn%3Aaws%3As3%3A%3A%3Asample-loaddata01%22+++++++++++++%5D+++++++++%7D+++++%5D+%7D+Create+an+IAM+role+and+modify+the+trust+relationship+according+to+the+following+code.+AssumeRole+allows+Aurora+to+access+other+AWS+services+on+your+behalf.+%7B+%22Version%22%3A+%222012-10-17%22%2C+++%22Statement%22%3A+%5B+++++%7B+++++++%22Effect%22%3A+%22Allow%22%2C+++++++%22Principal%22%3A+%7B+++++++++%22Service%22%3A+%22rds.amazonaws.com%22+++++++%7D%2C+++++++%22Action%22%3A+%22sts%3AAssumeRole%22+++++%7D+++%5D+%7D+Attach+the+policy+aurora-s3-access-pol+from+the+previous+step.+For+this+post%2C+the+role+is+named+s3-demo-access-role+and+the+role+ARN+is+arn%3Aaws%3Aiam%3A%3A123456789012%3Arole%2Faurora-s3-access-role.+Create+and+assign+parameter+groups+for+the+cluster%3A+Create+a+custom+parameter+group+using+the+AWS+Command+Line+Interface+%28AWS+CLI%29.+See+the+following+code%3A+aws+rds+create-db-cluster-parameter-group+%5C+--db-cluster-parameter-group-name+aurora-cluster-para-grp+%5C+--db-parameter-group-family+aurora5.6+%5C+--description+%22cluster+parameter+group+for+s3+copy%22++Modify+the+parameter+group+to+edit+the+value+of+the+aurora_default_s3_role+parameter+to+the+IAM+role+s3-demo-access-role.+See+the+following+code%3A+aws+rds+modify-db-cluster-parameter-group+%5C+++--db-cluster-parameter-group-name+aurora-cluster-para-grp+%5C+++--parameters+%22ParameterName%3Daurora_default_s3_role%2CParameterValue%3Darn%3Aaws%3Aiam%3A%3A123456789012%3Arole%2Faurora-s3-access-role%2CApplyMethod%3Dimmediate%22+You+can+map+the+IAM+role+to+the+aurora_select_into_s3_role+parameter+to+allow+only+data+export+or+map+the+aurora_load_from_s3_role+parameter+to+allow+only+data+import+from+the+S3+bucket.+If+the+IAM+role+isn%E2%80%99t+specified+for+these+two+parameters%2C+Aurora+uses+the+IAM+role+specified+in+aws_default_s3_role+for+both+export+and+import.++Modify+the+Aurora+cluster+and+associate+the+newly+created+parameter+group.+See+the+following+code%3A+aws+rds+modify-db-cluster+%5C+++--db-cluster-identifier+database-1+%5C+++--db-cluster-parameter-group-name+aurora-cluster-para-grp+%5C+++--apply-immediately+The+apply-immediately+code+triggers+modification+and+asynchronously+applies+changes+as+soon+as+possible+regardless+of+the+PreferredMaintenanceWindow+on+the+DB+cluster.++Associate+the+IAM+role+to+the+cluster.+This+allows+database+users+in+an+Aurora+DB+cluster+to+access+the+S3+bucket.+See+the+following+code%3A+aws+rds+add-role-to-db-cluster+%5C+++++--db-cluster-identifier+database-1+%5C+++++--role-arn+arn%3Aaws%3Aiam%3A%3A123456789012%3Arole%2Faurora-s3-access-role+Reboot+the+primary+instance+in+the+cluster+to+apply+the+changes.+See+the+following+code%3A+aws+rds+reboot-db-instance+%5C+++++++--db-instance-identifier+database-1-instance-1+You%E2%80%99re+now+ready+to+explore+the+following+use+cases+of+exporting+and+importing+data.++Exporting+data+from+Aurora+MySQL+to+Amazon+S3+To+export+your+data%2C+complete+the+following+steps%3A++Connect+to+the+cluster+as+the+master+user.+By+default%2C+the+master+user+has+permission+to+export+and+import+data+from+Amazon+S3.+For+this+post%2C+you+create+a+test+user+with+the+least-required+permission+to+export+data+to+the+S3+bucket.+See+the+following+code%3A+%24+mysql+-h+database-1.cluster-xxxxxxxxxxxx.us-west-2.rds.amazonaws.com+-D+sampledb01+-P+3306+-u+admin01+-p+Create+the+user+testuser+and+grant+the+required+privileges+to+the+user+on+the+database.+This+post+uses+sampledb01.+See+the+following+code%3A+MySQL%3E+create+user+%27testuser%27%40%27%25%27+identified+by+%27Password%27%3B+MySQL%3E+grant+select+on+sampledb01.*+to+%27testuser%27%40%27%25%27%3B+Grant+the+SELECT+INTO+S3+privilege+to+testuser+with+the+following+code%3A+MySQL%3E+grant+SELECT+INTO+S3+on+*.*+to+%27testuser%27%40%27%25%27%3B+Log+in+to+the+cluster+as+testuser%3A+%24+mysql+-h+database-1.cluster-xxxxxxxxxxxx.us-west-2.rds.amazonaws.com+-D+sampledb01+-P+3306+-u+testuser+-p+For+this+post%2C+you+export+the+lineitem+table+to+the+S3+bucket.+You+can+use+any+existing+table+in+your+database+%28preferably+small+size%29+to+test+this+feature.+See+the+following+code%3A+MySQL%3E+describe+lineitem%3B+%2B-----------------%2B-------------%2B------%2B-----%2B---------%2B-------%2B+%7C+Field+++++++++++%7C+Type++++++++%7C+Null+%7C+Key+%7C+Default+%7C+Extra+%7C+%2B-----------------%2B-------------%2B------%2B-----%2B---------%2B-------%2B+%7C+orderkey++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+linenumber++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+custkey+++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+partkey+++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+suppkey+++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+orderdate+++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+orderpriority+++%7C+varchar%2815%29+%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+shippriority++++%7C+varchar%281%29++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+quantity++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+extendedprice+++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+ordertotalprice+%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+discount++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+revenue+++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+supplycost++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+tax+++++++++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+commitdate++++++%7C+int%2811%29+++++%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%7C+lshipmode+++++++%7C+varchar%2810%29+%7C+NO+++%7C+++++%7C+NULL++++%7C+++++++%7C+%2B-----------------%2B-------------%2B------%2B-----%2B---------%2B-------%2B++The+following+screenshot+displays+a+few+records+from+the+lineitem+table.+++To+export+data+from+the+Aurora+table+to+the+S3+bucket%2C+use+the+SELECT+INTO+OUTFILE+S3+The+following+statement+exports+the+entire+table+to+the+S3+bucket.+If+you%E2%80%99re+trying+this+feature+out+for+the+first+time%2C+consider+using+the+LIMIT+clause+for+a+larger+table.+See+the+following+code%3A+MySQL%3E+SELECT+*+FROM+lineitem+INTO+OUTFILE+S3++%27s3%3A%2F%2Fsample-loaddata01%2Funload-data%2Ffile%27+FIELDS+TERMINATED+BY+%27%2C%27+LINES+TERMINATED+BY+%27%5Cn%27%3B+Query+OK%2C+50000000+rows+affected+%283+min+37.05+sec%29+The+following+code+shows+the+exported+file+in+the+S3+bucket.+The+default+file+size+threshold+is+6+GB.+Because+the+data+selected+by+the+statement+is+less+than+the+file+size+threshold%2C+a+single+file+is+created.++%24aws+s3+ls+s3%3A%2F%2Fsample-loaddata01%2Funload-data+--recursive+--human-readable+--summarize+2020-04-29+00%3A10%3A17++++4.7+GiB+unload-data%2Ffile.part_00000+If+you+need+the+file+size+to+be+smaller+than+6+GB%2C+you+can+identify+a+column+to+split+the+table+data+into+small+portions+and+run+multiple+SELECT+INTO+OUTFILE+statements+%28using+the+WHERE+condition%29.+It%E2%80%99s+best+to+do+this+when+the+amount+of+data+selected+is+more+than+25+GB.++Importing+data+from+Amazon+S3+to+Aurora+MySQL+In+this+section%2C+you+load+the+data+back+to+the+Aurora+table+from+the+Amazon+S3+file.+Complete+the+following+steps%3A++Grant+the+LOAD+FROM+S3+privilege+to+testuser.+See+the+following+code%3A+MySQL%3E+grant+LOAD+FROM+S3+on+*.*+to+%27testuser%27%40%27%25%27%3B+Use+LOAD+DATA+FROM+S3+to+import+the+data+file+from+an+Amazon+S3+prefix.+See+the+following+code%3A+MySQL+%3E+LOAD+DATA+FROM+S3+PREFIX+%27s3%3A%2F%2Fsample-loaddata01%2Funload-data%2Ffile%27+INTO+TABLE+lineitem++FIELDS+TERMINATED+BY+%27%2C%27++++LINES+TERMINATED+BY+%27%5Cn%27+%28orderkey%2Clinenumber%2Ccustkey%2Cpartkey%2Csuppkey%2Corderdate%2Corderpriority%2Cshippriority%2Cquantity%2Cextendedprice%2Cordertotalprice%2Cdiscount%2Crevenue%2Csupplycost%2Ctax%2Ccommitdate%2Cshipmode%29%3B+Query+OK%2C+50000000+rows+affected+%28+8+min+16+sec%29+Verify+the+loaded+files+using+the+aurora_s3_load_history+system+table.+See+the+following+code%3A+MySQL%3E+select+*+from+mysql.aurora_s3_load_history+order+by+load_timestamp+desc+limit+1%5CG%3B++***************************+1.+row+***********************+++load_prefix%3A+s3%3A%2F%2Fsample-loaddata01%2Funload-data%2Ffile++++++file_name%3A+unload-data%2Ffile.part_00000+version_number%3A++++bytes_loaded%3A+5052058881+load_timestamp%3A+2020-05-05+18%3A09%3A53+Best+practices","d":"segmentfault.com","r":"https://segmentfault.com/","w":1920}